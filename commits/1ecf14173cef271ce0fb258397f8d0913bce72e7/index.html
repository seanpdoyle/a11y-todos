<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Use the title from a page's frontmatter if it has one -->
    <title>Treat Lists as separate tab stops
</title>
    <link href="../../stylesheets/site.css" rel="stylesheet" />
    <script src="../../javascripts/site.js"></script>
  </head>
  <body class="page">
    <header class="header">
      <h1 class="header__name">
<a href="../../">          a11y-todos
</a>      </h1>


      <nav class="
        header__navigation
        navigation
        navigation--previous
      ">
<a href="../9a0350ba47b04922f902c93a789f54c22342d30b/">              &#8592; Previous
</a>
      </nav>
    </header>

    <main class="content">
      <details class="accordion content__item">
        <summary class="accordion__summary">
          <div class="accordion__closed">
            <nav class="
              commit-history
              u-db-overflow-y--auto
              u-mb-overflow-x--scroll
            ">
                <a href="../4940917510781bfb9d2314695ec402b2e1609f98/" class="commit-node commit-node--collapsed" title="[SKIP]: Create `git-read` GitHub Action
"></a>
                <a href="../4bda2844904815465f33094f6e5dbc9418b0efa0/" class="commit-node commit-node--collapsed" title="[SKIP]: State project goals in a README"></a>
                <a href="../850de19eef9666c3de8829e7749b272165bef616/" class="commit-node commit-node--collapsed" title="[GENERATED]: Initial Commit
"></a>
                <a href="../7d3c5439519d8b9629f3096b4da6bf46efb214f7/" class="commit-node commit-node--collapsed" title="[GENERATED]: Generate db/schema.rb
"></a>
                <a href="../ada2db0c84b8d834edd6eaa771fe60082d0588c9/" class="commit-node commit-node--collapsed" title="Mark Tasks as completed
"></a>
                <a href="../c91b93ba4a41e2bef68360377a9e7ecc66da4125/" class="commit-node commit-node--collapsed" title="Delay multiple Tasks
"></a>
                <a href="../86fee705e5bae5e87051da40c1157b4a3dd3ae0c/" class="commit-node commit-node--collapsed" title="Promote a Task from Delayed back to To-do
"></a>
                <a href="../43769edd0572f51c1ef2f3144ad63a3486721910/" class="commit-node commit-node--collapsed" title="Reopen a Task that was Completed
"></a>
                <a href="../0d32daf69e541bfbcee4464490f96b242a60d506/" class="commit-node commit-node--collapsed" title="Style with TailwindCSS
"></a>
                <a href="../5db2e3f05365ba05d1954b827dc1d7ce6e5265a3/" class="commit-node commit-node--collapsed" title="Open the `&lt;dialog&gt;` with a `&lt;button&gt;`
"></a>
                <a href="../8a049e3deab58b76b31d00945e0a95361d9238da/" class="commit-node commit-node--collapsed" title="Open Bulk Action `&lt;form&gt;` modally
"></a>
                <a href="../31700878e11036bc4607a8c4a1a036714776596d/" class="commit-node commit-node--collapsed" title="Close &lt;dialog&gt; when Bulk selection is empty
"></a>
                <a href="../50d7876a636fc80ea994a0afbeae8550a48e8b81/" class="commit-node commit-node--collapsed" title="Mark &lt;main inert&gt; when &lt;dialog&gt; open
"></a>
                <a href="../9a0350ba47b04922f902c93a789f54c22342d30b/" class="commit-node commit-node--collapsed" title="Declare as role=&quot;grid&quot;
"></a>
                <a href="./" class="commit-node commit-node--collapsed" title="Treat Lists as separate tab stops
" aria-current="page"></a>
            </nav>

            <div class="accordion__toggle">
              <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="accordion--desktop"><title>Expand History</title>
  <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 01.708 0l6 6a.5.5 0 010 .708l-6 6a.5.5 0 01-.708-.708L10.293 8 4.646 2.354a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


              <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="accordion--mobile"><title>Expand History</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>

            </div>
          </div>

          <div class="accordion__opened">
            <div class="accordion__toggle accordion__toggle--fill">
              <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="accordion--desktop"><title>Collapse History</title>
  <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 010 .708L5.707 8l5.647 5.646a.5.5 0 01-.708.708l-6-6a.5.5 0 010-.708l6-6a.5.5 0 01.708 0z" clip-rule="evenodd"></path>
</svg>


              <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="accordion--mobile"><title>Collapse History</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>

            </div>
          </div>
        </summary>

        <nav class="
          commit-history
          commit-history--full
          u-db-overflow-y--auto
          u-mb-overflow-x--scroll
        ">
<a href="../4940917510781bfb9d2314695ec402b2e1609f98/" class="commit-node commit-node--full">              <p>[SKIP]: Create <code>git-read</code> GitHub Action</p>

</a><a href="../4bda2844904815465f33094f6e5dbc9418b0efa0/" class="commit-node commit-node--full">              <p>[SKIP]: State project goals in a README</p>

</a><a href="../850de19eef9666c3de8829e7749b272165bef616/" class="commit-node commit-node--full">              <p>[GENERATED]: Initial Commit</p>

</a><a href="../7d3c5439519d8b9629f3096b4da6bf46efb214f7/" class="commit-node commit-node--full">              <p>[GENERATED]: Generate db/schema.rb</p>

</a><a href="../ada2db0c84b8d834edd6eaa771fe60082d0588c9/" class="commit-node commit-node--full">              <p>Mark Tasks as completed</p>

</a><a href="../c91b93ba4a41e2bef68360377a9e7ecc66da4125/" class="commit-node commit-node--full">              <p>Delay multiple Tasks</p>

</a><a href="../86fee705e5bae5e87051da40c1157b4a3dd3ae0c/" class="commit-node commit-node--full">              <p>Promote a Task from Delayed back to To-do</p>

</a><a href="../43769edd0572f51c1ef2f3144ad63a3486721910/" class="commit-node commit-node--full">              <p>Reopen a Task that was Completed</p>

</a><a href="../0d32daf69e541bfbcee4464490f96b242a60d506/" class="commit-node commit-node--full">              <p>Style with TailwindCSS</p>

</a><a href="../5db2e3f05365ba05d1954b827dc1d7ce6e5265a3/" class="commit-node commit-node--full">              <p>Open the <code>&lt;dialog&gt;</code> with a <code>&lt;button&gt;</code></p>

</a><a href="../8a049e3deab58b76b31d00945e0a95361d9238da/" class="commit-node commit-node--full">              <p>Open Bulk Action <code>&lt;form&gt;</code> modally</p>

</a><a href="../31700878e11036bc4607a8c4a1a036714776596d/" class="commit-node commit-node--full">              <p>Close <dialog> when Bulk selection is empty</p>

</a><a href="../50d7876a636fc80ea994a0afbeae8550a48e8b81/" class="commit-node commit-node--full">              <p>Mark <main inert> when <dialog> open</p>

</a><a href="../9a0350ba47b04922f902c93a789f54c22342d30b/" class="commit-node commit-node--full">              <p>Declare as role=&quot;grid&quot;</p>

</a><a href="./" class="commit-node commit-node--full" aria-current="page">              <p>Treat Lists as separate tab stops</p>

</a>        </nav>
      </details>

      <article class="
        commit-content
        commit-content--double
        content__item
        content__item--grow
      ">
        <section class="commit commit--message">

          <h1 id="treat-lists-as-separate-tab-stops">Treat Lists as separate tab stops</h1>

<p>Declare the <code>TabstopList</code> Stimulus controller, along with the
<code>trapFocus()</code> and <code>navigate()</code> actions.</p>

<p>When a list gains focus, find all focusable elements (like <code>&lt;button&gt;</code>,
<code>&lt;input&gt;</code>, <code>&lt;select&gt;</code>, etc), and prevent focus by [setting their
<code>[tabindex=&quot;-1&quot;]</code>][mdn-tabindex-1]. Then, re-set the focused element&rsquo;s
<code>[tabindex=&quot;0&quot;]</code> to treat it as the place to resume once focus is
regained.</p>

<p>To go along with that restriction, treat the up and down arrows as
keyboard shortcuts to move between focusable items in the list.</p>

        </section>

          <aside class="commit commit--diff commit--long-content">
              <details
  id="app/javascript/controllers/tabstop_list_controller.js"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse app/javascript/controllers/tabstop_list_controller.js</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand app/javascript/controllers/tabstop_list_controller.js</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      app/javascript/controllers/tabstop_list_controller.js
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/app/javascript/controllers/tabstop_list_controller.js b/app/javascript/controllers/tabstop_list_controller.js
</span><span class="p">new file mode 100644
</span><span class="gh">index 0000000..776b11b
</span><span class="gd">--- /dev/null
</span><span class="gi">+++ b/app/javascript/controllers/tabstop_list_controller.js
</span><span class="p">@@ -0,0 +1,50 @@</span>
<span class="gi">+import { Controller } from "stimulus"
+
+export default class extends Controller {
+  static values = { horizontal: Boolean }
+
+  trapFocus({ target }) {
+    if (this.focusableElements.some(element =&gt; element.contains(target))) {
+      this.focusableElements.forEach(element =&gt; element.setAttribute("tabindex", -1))
+
+      target.setAttribute("tabindex", 0)
+    }
+  }
+
+  navigate(event) {
+    if (this.navigationKeys.includes(event.key)) {
+      event.preventDefault()
+
+      const { activeElement } = document
+      const index = this.focusableElements.findIndex(element =&gt; element == activeElement)
+      const direction = this.directions[event.key]
+      const element = this.focusableElements[index + direction]
+
+      element?.focus()
+    }
+  }
+
+  get navigationKeys() {
+    const vertical = [ "ArrowUp", "ArrowDown" ]
+    const horizontal = [ "ArrowRight", "ArrowLeft" ]
+
+    return this.horizontalValue ?
+      vertical + horizontal :
+      vertical
+  }
+
+  get directions() {
+    return {
+      ArrowUp: -1,
+      ArrowLeft: -1,
+      ArrowDown: +1,
+      ArrowRight: +1,
+    }
+  }
+
+  get focusableElements() {
+    const selector = `button, textarea, select, input:not([type="hidden"])`
+
+    return Array.from(this.element.querySelectorAll(selector))
+  }
+}
</span></code></pre></div></details>

              <details
  id="app/views/events/new.html.erb"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse app/views/events/new.html.erb</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand app/views/events/new.html.erb</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      app/views/events/new.html.erb
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/app/views/events/new.html.erb b/app/views/events/new.html.erb
index aa24cd9..d02ab0a 100644
</span><span class="gd">--- a/app/views/events/new.html.erb
</span><span class="gi">+++ b/app/views/events/new.html.erb
</span><span class="p">@@ -8,7 +8,7 @@</span>
 
   &lt;fieldset&gt;
     &lt;table role="grid"&gt;
<span class="gd">-      &lt;tbody&gt;
</span><span class="gi">+      &lt;tbody data-controller="tabstop-list" data-action="focusin-&gt;tabstop-list#trapFocus keydown-&gt;tabstop-list#navigate"&gt;
</span>         &lt;%= form.collection_check_boxes :task_ids, tasks.todo, :id, :name do |builder| %&gt;
           &lt;%= render "row", class: "absolute",
             "data-controller": "tethered", "data-tethered-selector-value": "#" + dom_id(builder.object) do %&gt;
<span class="p">@@ -30,7 +30,7 @@</span>
         &lt;% end %&gt;
       &lt;/tbody&gt;
 
<span class="gd">-      &lt;tfoot&gt;
</span><span class="gi">+      &lt;tfoot data-controller="tabstop-list" data-tabstop-list-horizontal-value="true" data-action="focusin-&gt;tabstop-list#trapFocus keydown-&gt;tabstop-list#navigate"&gt;
</span>         &lt;%= render "row", class: "absolute justify-center left-0 right-0" do %&gt;
           &lt;% with_options scope: [:helpers, :submit, :event] do |action| %&gt;
             &lt;td role="cell"&gt;
</code></pre></div></details>

              <details
  id="app/views/tasks/index.html.erb"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse app/views/tasks/index.html.erb</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand app/views/tasks/index.html.erb</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      app/views/tasks/index.html.erb
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/app/views/tasks/index.html.erb b/app/views/tasks/index.html.erb
index bc02f46..079e24c 100644
</span><span class="gd">--- a/app/views/tasks/index.html.erb
</span><span class="gi">+++ b/app/views/tasks/index.html.erb
</span><span class="p">@@ -2,7 +2,7 @@</span>
 &lt;section&gt;
   &lt;h2 class="text-2xl"&gt;&lt;%= translate(".todo") %&gt;&lt;/h1&gt;
 
<span class="gd">-  &lt;table role="grid"&gt;
</span><span class="gi">+  &lt;table role="grid" data-controller="tabstop-list" data-action="focusin-&gt;tabstop-list#trapFocus keydown-&gt;tabstop-list#navigate"&gt;
</span>     &lt;% tasks.todo.each do |task| %&gt;
       &lt;%= render "row", id: dom_id(task) do %&gt;
         &lt;td role="cell"&gt;
<span class="p">@@ -27,7 +27,7 @@</span>
 &lt;section&gt;
   &lt;h2 class="text-2xl"&gt;&lt;%= translate(".delayed") %&gt;&lt;/h2&gt;
 
<span class="gd">-  &lt;table role="grid"&gt;
</span><span class="gi">+  &lt;table role="grid" data-controller="tabstop-list" data-action="focusin-&gt;tabstop-list#trapFocus keydown-&gt;tabstop-list#navigate"&gt;
</span>     &lt;% tasks.delayed.each do |task| %&gt;
       &lt;%= render "row", id: dom_id(task) do %&gt;
         &lt;td role="cell"&gt;&lt;%= task.name %&gt;&lt;/td&gt;
<span class="p">@@ -50,7 +50,7 @@</span>
 &lt;section&gt;
   &lt;h2 class="text-2xl"&gt;&lt;%= translate(".completed") %&gt;&lt;/h2&gt;
 
<span class="gd">-  &lt;table role="grid"&gt;
</span><span class="gi">+  &lt;table role="grid" data-controller="tabstop-list" data-action="focusin-&gt;tabstop-list#trapFocus keydown-&gt;tabstop-list#navigate"&gt;
</span>     &lt;% tasks.completed.each do |task| %&gt;
       &lt;%= render "row", id: dom_id(task) do %&gt;
         &lt;td&gt;&amp;checkmark;&lt;/td&gt;
</code></pre></div></details>

              <details
  id="test/system/tasks_test.rb"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse test/system/tasks_test.rb</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand test/system/tasks_test.rb</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      test/system/tasks_test.rb
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/test/system/tasks_test.rb b/test/system/tasks_test.rb
index 2af57d1..803682c 100644
</span><span class="gd">--- a/test/system/tasks_test.rb
</span><span class="gi">+++ b/test/system/tasks_test.rb
</span><span class="p">@@ -106,6 +106,36 @@</span> class TasksTest &lt; ApplicationSystemTestCase
     end
   end
 
<span class="gi">+  test "treats the lists as separate tab stops" do
+    todo, completed = tasks(:pass_the_test, :read_the_book)
+
+    visit root_path
+    send_keys :tab
+    send_keys :down
+    send_keys :tab
+
+    assert_button completed.name, focused: true
+
+    send_keys [:shift, :tab]
+
+    assert_button todo.name, focused: true
+  end
+
+  test "navigates the Bulk Action buttons with arrow keys" do
+    do_the_homework = tasks(:do_the_homework)
+
+    visit root_path
+    click_on do_the_homework.name
+    send_keys :tab
+    send_keys :down
+
+    assert_button submit(:event, :delay), focused: true
+
+    send_keys :right
+
+    assert_button submit(:event, :close), focused: true
+  end
+
</span>   def send_keys(*arguments)
     (active_element || find("body")).send_keys(*arguments)
   end
</code></pre></div></details>

          </aside>
      </article>
    </main>
  </body>
</html>
