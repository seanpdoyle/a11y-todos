<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Use the title from a page's frontmatter if it has one -->
    <title>Close <dialog> when Bulk selection is empty
</title>
    <link href="../../stylesheets/site.css" rel="stylesheet" />
    <script src="../../javascripts/site.js"></script>
  </head>
  <body class="page">
    <header class="header">
      <h1 class="header__name">
<a href="../../">          a11y-todos
</a>      </h1>


      <nav class="
        header__navigation
        navigation
        
      ">
<a href="../e9c1273e6a2d581103458f46798808ec8d605c32/">              &#8592; Previous
</a>
<a href="../25a8abb964f080a1bef51b14c34eab01dc72a595/">              Next &#8594;
</a>      </nav>
    </header>

    <main class="content">
      <details class="accordion content__item">
        <summary class="accordion__summary">
          <div class="accordion__closed">
            <nav class="
              commit-history
              u-db-overflow-y--auto
              u-mb-overflow-x--scroll
            ">
                <a href="../4940917510781bfb9d2314695ec402b2e1609f98/" class="commit-node commit-node--collapsed" title="[SKIP]: Create `git-read` GitHub Action
"></a>
                <a href="../4bda2844904815465f33094f6e5dbc9418b0efa0/" class="commit-node commit-node--collapsed" title="[SKIP]: State project goals in a README"></a>
                <a href="../850de19eef9666c3de8829e7749b272165bef616/" class="commit-node commit-node--collapsed" title="[GENERATED]: Initial Commit
"></a>
                <a href="../7d3c5439519d8b9629f3096b4da6bf46efb214f7/" class="commit-node commit-node--collapsed" title="[GENERATED]: Generate db/schema.rb
"></a>
                <a href="../277efa4b64d78f0da025fd4c7c9d7e807ec2a90b/" class="commit-node commit-node--collapsed" title="Section 1: The Rails"></a>
                <a href="../6cf53ea5802819e1f92ce943fe023a1cb6eaceb8/" class="commit-node commit-node--collapsed" title="Mark Tasks as completed
"></a>
                <a href="../1253256c6914c7a5911c11c1ff7ed919d8ff11ef/" class="commit-node commit-node--collapsed" title="Delay multiple Tasks
"></a>
                <a href="../f8d56197fec145a33cb475dae520efd28c604d67/" class="commit-node commit-node--collapsed" title="Promote a Task from Delayed back to To-do
"></a>
                <a href="../c84fcdd2203e7d48d39d723db48427863d10a0b5/" class="commit-node commit-node--collapsed" title="Reopen a Task that was Completed
"></a>
                <a href="../7f26d97b51c26dd9b19d5d4200917af288c5ecd5/" class="commit-node commit-node--collapsed" title="Style with TailwindCSS
"></a>
                <a href="../2c99dc34fd5146124d0aebbd276278a8155e5478/" class="commit-node commit-node--collapsed" title="Section 2: The JavaScript"></a>
                <a href="../e398b53d6030d634e33b57a1e0480376f6fa57ad/" class="commit-node commit-node--collapsed" title="Open the `&lt;dialog&gt;` with a `&lt;button&gt;`
"></a>
                <a href="../e9c1273e6a2d581103458f46798808ec8d605c32/" class="commit-node commit-node--collapsed" title="Open Bulk Action `&lt;form&gt;` modally
"></a>
                <a href="./" class="commit-node commit-node--collapsed" title="Close &lt;dialog&gt; when Bulk selection is empty
" aria-current="page"></a>
                <a href="../25a8abb964f080a1bef51b14c34eab01dc72a595/" class="commit-node commit-node--collapsed" title="Fetch the `&lt;dialog&gt;` contents when opened
"></a>
                <a href="../9b5d8d8d824939e1f2b76c180a9db68f7e817ae4/" class="commit-node commit-node--collapsed" title="Treat Lists as separate tab stops
"></a>
                <a href="../20b1f2472b99aaad8efe5c2e3f8e075552b29a86/" class="commit-node commit-node--collapsed" title="Section 3: How can we improve accessibility?"></a>
                <a href="../c46cf530af6c0be22e49bcf5307d54be64aec7bf/" class="commit-node commit-node--collapsed" title="Mark &lt;main inert&gt; when &lt;dialog&gt; open
"></a>
                <a href="../066649db305f74aaac612f018a6d13d64efd7587/" class="commit-node commit-node--collapsed" title="Announce selected Task count
"></a>
            </nav>

            <div class="accordion__toggle">
              <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="accordion--desktop"><title>Expand History</title>
  <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 01.708 0l6 6a.5.5 0 010 .708l-6 6a.5.5 0 01-.708-.708L10.293 8 4.646 2.354a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


              <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="accordion--mobile"><title>Expand History</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>

            </div>
          </div>

          <div class="accordion__opened">
            <div class="accordion__toggle accordion__toggle--fill">
              <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="accordion--desktop"><title>Collapse History</title>
  <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 010 .708L5.707 8l5.647 5.646a.5.5 0 01-.708.708l-6-6a.5.5 0 010-.708l6-6a.5.5 0 01.708 0z" clip-rule="evenodd"></path>
</svg>


              <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="accordion--mobile"><title>Collapse History</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>

            </div>
          </div>
        </summary>

        <nav class="
          commit-history
          commit-history--full
          u-db-overflow-y--auto
          u-mb-overflow-x--scroll
        ">
<a href="../4940917510781bfb9d2314695ec402b2e1609f98/" class="commit-node commit-node--full">              <p>[SKIP]: Create <code>git-read</code> GitHub Action</p>

</a><a href="../4bda2844904815465f33094f6e5dbc9418b0efa0/" class="commit-node commit-node--full">              <p>[SKIP]: State project goals in a README</p>

</a><a href="../850de19eef9666c3de8829e7749b272165bef616/" class="commit-node commit-node--full">              <p>[GENERATED]: Initial Commit</p>

</a><a href="../7d3c5439519d8b9629f3096b4da6bf46efb214f7/" class="commit-node commit-node--full">              <p>[GENERATED]: Generate db/schema.rb</p>

</a><a href="../277efa4b64d78f0da025fd4c7c9d7e807ec2a90b/" class="commit-node commit-node--full">              <p>Section 1: The Rails</p>

</a><a href="../6cf53ea5802819e1f92ce943fe023a1cb6eaceb8/" class="commit-node commit-node--full">              <p>Mark Tasks as completed</p>

</a><a href="../1253256c6914c7a5911c11c1ff7ed919d8ff11ef/" class="commit-node commit-node--full">              <p>Delay multiple Tasks</p>

</a><a href="../f8d56197fec145a33cb475dae520efd28c604d67/" class="commit-node commit-node--full">              <p>Promote a Task from Delayed back to To-do</p>

</a><a href="../c84fcdd2203e7d48d39d723db48427863d10a0b5/" class="commit-node commit-node--full">              <p>Reopen a Task that was Completed</p>

</a><a href="../7f26d97b51c26dd9b19d5d4200917af288c5ecd5/" class="commit-node commit-node--full">              <p>Style with TailwindCSS</p>

</a><a href="../2c99dc34fd5146124d0aebbd276278a8155e5478/" class="commit-node commit-node--full">              <p>Section 2: The JavaScript</p>

</a><a href="../e398b53d6030d634e33b57a1e0480376f6fa57ad/" class="commit-node commit-node--full">              <p>Open the <code>&lt;dialog&gt;</code> with a <code>&lt;button&gt;</code></p>

</a><a href="../e9c1273e6a2d581103458f46798808ec8d605c32/" class="commit-node commit-node--full">              <p>Open Bulk Action <code>&lt;form&gt;</code> modally</p>

</a><a href="./" class="commit-node commit-node--full" aria-current="page">              <p>Close <dialog> when Bulk selection is empty</p>

</a><a href="../25a8abb964f080a1bef51b14c34eab01dc72a595/" class="commit-node commit-node--full">              <p>Fetch the <code>&lt;dialog&gt;</code> contents when opened</p>

</a><a href="../9b5d8d8d824939e1f2b76c180a9db68f7e817ae4/" class="commit-node commit-node--full">              <p>Treat Lists as separate tab stops</p>

</a><a href="../20b1f2472b99aaad8efe5c2e3f8e075552b29a86/" class="commit-node commit-node--full">              <p>Section 3: How can we improve accessibility?</p>

</a><a href="../c46cf530af6c0be22e49bcf5307d54be64aec7bf/" class="commit-node commit-node--full">              <p>Mark <main inert> when <dialog> open</p>

</a><a href="../066649db305f74aaac612f018a6d13d64efd7587/" class="commit-node commit-node--full">              <p>Announce selected Task count</p>

</a>        </nav>
      </details>

      <article class="
        commit-content
        commit-content--double
        content__item
        content__item--grow
      ">
        <section class="commit commit--message">

          <h1 id="close-when-bulk-selection-is-empty">Close <dialog> when Bulk selection is empty</h1>

<p>Once all of the <code>&lt;form&gt;</code> element&rsquo;s descendant <code>&lt;input type=&quot;checkbox&quot;&gt;</code>
elements are unchecked, trigger a <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLFormElement/reset_event"><code>reset</code> event</a>.</p>

<p>Then, listen for descendant elements of the <code>&lt;dialog&gt;</code> element to fire
<code>reset</code> events, and call <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLDialogElement/close"><code>HTMLDilogElement.close()</code></a>
to close the dialog.</p>

        </section>

          <aside class="commit commit--diff commit--long-content">
              <details
  id="app/javascript/controllers/bulk_controller.js"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse app/javascript/controllers/bulk_controller.js</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand app/javascript/controllers/bulk_controller.js</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      app/javascript/controllers/bulk_controller.js
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/app/javascript/controllers/bulk_controller.js b/app/javascript/controllers/bulk_controller.js
index d800b82..b1fb5d7 100644
</span><span class="gd">--- a/app/javascript/controllers/bulk_controller.js
</span><span class="gi">+++ b/app/javascript/controllers/bulk_controller.js
</span><span class="p">@@ -5,9 +5,7 @@</span> export default class extends Controller {
 
   select({ currentTarget }) {
     const value = currentTarget.getAttribute(`data-${this.identifier}-value`)
<span class="gd">-    const inputTargets = Array.from(this.formTarget.elements)
-
-    const input = inputTargets.find(input =&gt; input.value === value)
</span><span class="gi">+    const input = this.inputTargets.find(input =&gt; input.value === value)
</span> 
     if (input) {
       input.checked = true
<span class="p">@@ -15,7 +13,17 @@</span> export default class extends Controller {
     }
   }
 
<span class="gi">+  resetIfAllUnchecked() {
+    if (this.inputTargets.some(input =&gt; input.checked)) return
+
+    this.resetForm()
+  }
+
</span>   resetForm() {
     this.formTarget.reset()
   }
<span class="gi">+
+  get inputTargets() {
+    return Array.from(this.formTarget.elements)
+  }
</span> }
</code></pre></div></details>

              <details
  id="app/javascript/controllers/dialog_controller.js"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse app/javascript/controllers/dialog_controller.js</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand app/javascript/controllers/dialog_controller.js</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      app/javascript/controllers/dialog_controller.js
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/app/javascript/controllers/dialog_controller.js b/app/javascript/controllers/dialog_controller.js
index b231734..ef104ca 100644
</span><span class="gd">--- a/app/javascript/controllers/dialog_controller.js
</span><span class="gi">+++ b/app/javascript/controllers/dialog_controller.js
</span><span class="p">@@ -6,4 +6,10 @@</span> export default class extends Controller {
   connect() {
     dialogPolyfill.registerDialog(this.element)
   }
<span class="gi">+
+  close() {
+    if (this.element.open) {
+      this.element.close()
+    }
+  }
</span> }
</code></pre></div></details>

              <details
  id="app/views/events/new.html.erb"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse app/views/events/new.html.erb</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand app/views/events/new.html.erb</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      app/views/events/new.html.erb
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/app/views/events/new.html.erb b/app/views/events/new.html.erb
index 3314c46..9442652 100644
</span><span class="gd">--- a/app/views/events/new.html.erb
</span><span class="gi">+++ b/app/views/events/new.html.erb
</span><span class="p">@@ -1,6 +1,6 @@</span>
 &lt;%= form_with scope: :event, url: completions_path, html: {
<span class="gd">-  autocomplete: :off, "data-bulk-target": "form"
-} do |form| %&gt;
</span><span class="gi">+  autocomplete: :off, "data-bulk-target": "form", "data-action": "input-&gt;bulk#resetIfAllUnchecked"
+}  do |form| %&gt;
</span>   &lt;fieldset&gt;
     &lt;table&gt;
       &lt;tbody&gt;
<span class="p">@@ -35,6 +35,12 @@</span>
                 &lt;%= action.translate(:delay) %&gt;
               &lt;% end %&gt;
             &lt;/td&gt;
<span class="gi">+
+            &lt;td&gt;
+              &lt;%= render "button", builder: form, type: :reset, class: "bg-black text-white" do %&gt;
+                &lt;%= action.translate(:close) %&gt;
+              &lt;% end %&gt;
+            &lt;/td&gt;
</span>           &lt;% end %&gt;
         &lt;% end %&gt;
       &lt;/tfoot&gt;
</code></pre></div></details>

              <details
  id="app/views/layouts/application.html.erb"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse app/views/layouts/application.html.erb</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand app/views/layouts/application.html.erb</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      app/views/layouts/application.html.erb
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/app/views/layouts/application.html.erb b/app/views/layouts/application.html.erb
index 364caac..64d275b 100644
</span><span class="gd">--- a/app/views/layouts/application.html.erb
</span><span class="gi">+++ b/app/views/layouts/application.html.erb
</span><span class="p">@@ -14,7 +14,7 @@</span>
       &lt;%= yield %&gt;
     &lt;/main&gt;
 
<span class="gd">-    &lt;dialog data-controller="dialog" data-controls-dialog-target="dialog" data-action="close-&gt;bulk#resetForm" class="
</span><span class="gi">+    &lt;dialog data-controller="dialog" data-controls-dialog-target="dialog" data-action="close-&gt;bulk#resetForm reset-&gt;dialog#close" class="
</span>       backdrop:hidden
       bg-transparent
       border-0
</code></pre></div></details>

              <details
  id="config/locales/en.yml"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse config/locales/en.yml</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand config/locales/en.yml</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      config/locales/en.yml
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/config/locales/en.yml b/config/locales/en.yml
index 4625680..997c23c 100644
</span><span class="gd">--- a/config/locales/en.yml
</span><span class="gi">+++ b/config/locales/en.yml
</span><span class="p">@@ -33,6 +33,7 @@</span> en:
   helpers:
     submit:
       event:
<span class="gi">+        close: "Close"
</span>         complete: "Complete"
         delay: "Delay"
         promote: "Promote"
</code></pre></div></details>

              <details
  id="test/system/tasks_test.rb"
  open
  class="file"
>
  <summary class="file__name">
    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--close"><title>Collapse test/system/tasks_test.rb</title>
  <path fill-rule="evenodd" d="M7.646 4.646a.5.5 0 01.708 0l6 6a.5.5 0 01-.708.708L8 5.707l-5.646 5.647a.5.5 0 01-.708-.708l6-6z" clip-rule="evenodd"></path>
</svg>


    <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor" role="img" class="file__toggle file__toggle--open"><title>Expand test/system/tasks_test.rb</title>
  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 01.708 0L8 10.293l5.646-5.647a.5.5 0 01.708.708l-6 6a.5.5 0 01-.708 0l-6-6a.5.5 0 010-.708z" clip-rule="evenodd"></path>
</svg>


    <code>
      test/system/tasks_test.rb
    </code>
  </summary>

<div class="highlight"><pre class="highlight diff"><code><span class="gh">diff --git a/test/system/tasks_test.rb b/test/system/tasks_test.rb
index 2f4f127..0db8be3 100644
</span><span class="gd">--- a/test/system/tasks_test.rb
</span><span class="gi">+++ b/test/system/tasks_test.rb
</span><span class="p">@@ -60,6 +60,31 @@</span> class TasksTest &lt; ApplicationSystemTestCase
     end
   end
 
<span class="gi">+  test "resets the form when closing the modal" do
+    do_the_homework, pass_the_test = tasks(:do_the_homework, :pass_the_test)
+
+    visit root_path
+    click_on do_the_homework.name
+    click_on submit(:event, :close)
+    click_on pass_the_test.name
+
+    assert_no_checked_field do_the_homework.name
+    assert_checked_field pass_the_test.name
+  end
+
+  test "switches back to reading mode when there are no checked Tasks" do
+    do_the_homework = tasks(:do_the_homework)
+
+    visit root_path
+    click_on do_the_homework.name
+    uncheck do_the_homework.name
+
+    assert_no_button submit(:event, :complete)
+    within_section :todo do
+      assert_text do_the_homework.name
+    end
+  end
+
</span>   def assert_no_section(i18n_key)
     assert_no_text translate(i18n_key, scope: [:tasks, :index])
   end
</code></pre></div></details>

          </aside>
      </article>
    </main>
  </body>
</html>
